# import pandas as pd

# # --- ì„¤ì • (ì…ë ¥ íŒŒì¼ê³¼ ì¶œë ¥ íŒŒì¼ ì´ë¦„) ---
# INPUT_CSV_PATH = "bokjiro_final_processed.csv"   # ê¸°ì¡´ íŒŒì¼
# OUTPUT_CSV_PATH = "bokjiro_final_processed.csv"  # ê°™ì€ íŒŒì¼ëª…ìœ¼ë¡œ ë®ì–´ì“°ê¸°

# if __name__ == "__main__":
#     try:
#         # 1. ì›ë³¸ CSV íŒŒì¼ ì½ê¸°
#         df = pd.read_csv(INPUT_CSV_PATH)
#         print(f"'{INPUT_CSV_PATH}' íŒŒì¼ì„ ì½ëŠ” ì¤‘...")
#         print(f"ğŸ“Š ì›ë³¸ í–‰ ê°œìˆ˜: {len(df)}, ì…€ ê°œìˆ˜: {df.size}")

#         # 2. ë³µì§€ì‚¬ì—…ID ê¸°ì¤€ ì¤‘ë³µ ì²˜ë¦¬ (ì¤‘ì•™ë¶€ì²˜ë§Œ ìœ ì§€)
#         before_dup = len(df)
#         df = df.sort_values(by=["ì¶œì²˜"], ascending=False)  # ì¤‘ì•™ë¶€ì²˜ê°€ ë¨¼ì € ì˜¤ë„ë¡
#         df = df.drop_duplicates(subset=["ë³µì§€ì‚¬ì—…ID"], keep="first")
#         after_dup = len(df)
#         print(f"ğŸ“Š ë³µì§€ì‚¬ì—…ID ì¤‘ë³µ ì œê±° í›„ í–‰ ê°œìˆ˜: {after_dup} (ì œê±°ëœ í–‰ {before_dup - after_dup})")

#         # 3. ì¢…ë£Œì¼ í•„í„°ë§ (1970XXXX ìœ ì§€, 202501XX ~ 202508XX ì œê±°)
#         df["ì¢…ë£Œì¼"] = df["ì¢…ë£Œì¼"].astype(str).str.strip()

#         # ì œê±°í•  ì¢…ë£Œì¼ íŒ¨í„´ ì •ì˜
#         remove_prefixes = tuple([f"20250{i:02d}" for i in range(1, 9)])

#         before_filter = len(df)
#         df = df[
#             (df["ì¢…ë£Œì¼"].str.startswith("1970")) | 
#             (~df["ì¢…ë£Œì¼"].str[:6].isin(remove_prefixes))
#         ]
#         after_filter = len(df)
#         print(f"ğŸ“Š ì¢…ë£Œì¼ í•„í„°ë§ í›„ í–‰ ê°œìˆ˜: {after_filter} (ì œê±°ëœ í–‰ {before_filter - after_filter})")

#         # 4. ìµœì¢… ê²°ê³¼ ì €ì¥
#         df.to_csv(OUTPUT_CSV_PATH, index=False, encoding="utf-8-sig")

#         print("\n==============================================")
#         print(f"âœ… ìµœì¢… ì™„ë£Œ! '{OUTPUT_CSV_PATH}' íŒŒì¼ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.")
#         print(f"ğŸ“Š ìµœì¢… í–‰ ê°œìˆ˜: {len(df)}")
#         print(f"ğŸ“Š ìµœì¢… ì…€ ê°œìˆ˜: {df.size}")
#         print("==============================================")

#     except FileNotFoundError:
#         print(f"ğŸš¨ ì˜¤ë¥˜: '{INPUT_CSV_PATH}' íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.")
#     except Exception as e:
#         print(f"ğŸš¨ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ ë°œìƒ: {e}")

import pandas as pd

# --- ì„¤ì • (ì…ë ¥ íŒŒì¼ê³¼ ì¶œë ¥ íŒŒì¼ ì´ë¦„) ---
INPUT_CSV_PATH = "bokjiro_final_processed.csv"  # ì…ë ¥ íŒŒì¼
OUTPUT_CSV_PATH = "bokjiro_final_processed.csv" # ì €ì¥ íŒŒì¼ (ë®ì–´ì“°ê¸°)

if __name__ == "__main__":
    try:
        # 1. ì›ë³¸ CSV íŒŒì¼ ì½ê¸°
        df = pd.read_csv(INPUT_CSV_PATH)
        print(f"'{INPUT_CSV_PATH}' íŒŒì¼ì„ ì½ì—ˆìŠµë‹ˆë‹¤.")
        print(f"ğŸ“Š ì›ë³¸ í–‰ ê°œìˆ˜: {len(df)}")

        # 2. ì¢…ë£Œì¼ í•„í„°ë§ (ìš”ì²­ì‚¬í•­ ì •í™•íˆ ë°˜ì˜)
        # 'ì¢…ë£Œì¼' ì»¬ëŸ¼ì„ ë¬¸ìì—´ë¡œ ë³€í™˜í•©ë‹ˆë‹¤.
        df["ì¢…ë£Œì¼"] = df["ì¢…ë£Œì¼"].astype(str).str.strip()

        # ì œê±°í•  ì¢…ë£Œì¼ì˜ ì—°ë„-ì›”(YYYYMM) íŒ¨í„´ì„ ì •ì˜í•©ë‹ˆë‹¤. (2025ë…„ 1ì›” ~ 8ì›”)
        remove_prefixes = [f"20250{i}" for i in range(1, 9)] # ê²°ê³¼: ['202501', '202502', ..., '202508']

        before_filter_count = len(df)

        # í•„í„°ë§ ì¡°ê±´:
        # ì¡°ê±´ 1: ì¢…ë£Œì¼ì´ '1970'ìœ¼ë¡œ ì‹œì‘í•˜ëŠ” ë°ì´í„°ëŠ” "ìœ ì§€"
        condition_1970 = df["ì¢…ë£Œì¼"].str.startswith("1970")
        
        # ì¡°ê±´ 2: ì¢…ë£Œì¼ì˜ ì• 6ìë¦¬(YYYYMM)ê°€ remove_prefixes ë¦¬ìŠ¤íŠ¸ì— í¬í•¨ë˜ì§€ "ì•ŠëŠ”" ë°ì´í„° "ìœ ì§€"
        condition_2025 = ~df["ì¢…ë£Œì¼"].str[:6].isin(remove_prefixes)
        
        # ë‘ ì¡°ê±´ ì¤‘ í•˜ë‚˜ë¼ë„ ë§Œì¡±í•˜ë©´ ìµœì¢… ìœ ì§€
        df_filtered = df[condition_1970 | condition_2025]
        
        after_filter_count = len(df_filtered)
        
        print(f"ğŸ“Š ì¢…ë£Œì¼ í•„í„°ë§ í›„ í–‰ ê°œìˆ˜: {after_filter_count} (ì œê±°ëœ í–‰: {before_filter_count - after_filter_count})")

        # 3. ìµœì¢… ê²°ê³¼ ì €ì¥
        df_filtered.to_csv(OUTPUT_CSV_PATH, index=False, encoding="utf-8-sig")

        print("\n==============================================")
        print(f"âœ… ìµœì¢… ì™„ë£Œ! '{OUTPUT_CSV_PATH}' íŒŒì¼ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.")
        print(f"ğŸ“Š ìµœì¢… í–‰ ê°œìˆ˜: {len(df_filtered)}")
        print("==============================================")

    except FileNotFoundError:
        print(f"ğŸš¨ ì˜¤ë¥˜: '{INPUT_CSV_PATH}' íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.")
    except Exception as e:
        print(f"ğŸš¨ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ ë°œìƒ: {e}")